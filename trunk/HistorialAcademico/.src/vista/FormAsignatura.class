' Gambas class file

Public ControladorAplicacion As Controlador
Public Tmpasignatura As AsignaturaVO

Public Sub Form_Open()
  
  Me.center
  Me.Title = "asignatura"
  If Tmpasignatura.idasignatura = 0 Then
    'limpio los textbox
    limpio()
  Else
    'estoy editando
    rellena(Tmpasignatura)
  Endif
  
  TextBoxNombreasignatura.SetFocus()
  
End

Public Sub ToolButtonAceptar_Click()
  
  Tmpasignatura.Nombre = TextBoxNombreasignatura.Text
  Tmpasignatura.Detalle = TextAreaDetalle.Text
  
  If Tmpasignatura.idasignatura <> 0 Then
    If ControladorAplicacion.ModificarIdasignatura(Tmpasignatura) Then 
      'se ha a単adido bien el asignatura
      limpio()
      Me.Close()
      Return
    Else
      Message.Error(("Se ha producido un error al intentar a単adir el nuevo asignatura"))
      Return 
    Endif
  Endif
  
  If Tmpasignatura.idasignatura = 0 And If ControladorAplicacion.anadirasignatura(Tmpasignatura) Then 
    'se ha a単adido bien el nuevo alumno
    limpio()
    Me.Close()
    Return
  Else
    Message.Error(("Se ha producido un error al intentar a単adir el nuevo asignatura"))
    Return
  Endif
  
End

Public Sub limpio()
  
  TextAreaDetalle.text = ""
  TextBoxNombreasignatura.text = ""
  
End

Public Sub rellena(miasignatura As AsignaturaVO)
  
  TextBoxNombreasignatura.text = miasignatura.Nombre
  TextAreaDetalle.text = miasignatura.Detalle
  
End

Public Sub ToolButtonCancelar_Click()
  
  Me.Close()
  Return
  
End

Public Sub TextBoxNombreasignatura_KeyPress()
  
  If Key.code = Key.enter Or Key.code = Key.Return Then 
    TextAreaDetalle.SetFocus()
    Return 
  Endif
  
  'limitar caracteres  
  If Key.End = Key.CODE Or Key.Tab = Key.CODE Or Key.BackSpace = Key.CODE Or Key.delete = Key.code Or Key.Down = Key.code Or Key.Esc = Key.code Or Key.Tab = Key.code Or Key.Insert = Key.code Or Key.left = Key.code Or Key.Right = Key.code Then 
  Else
    
    If InStr(moduloletras.posibles, Str$(Key.text)) = 0 Then 
      Stop Event
    Endif
  Endif
  
End

Public Sub TextAreaDetalle_KeyPress()
  
  'limitar caracteres  
  If Key.End = Key.CODE Or Key.Tab = Key.CODE Or Key.BackSpace = Key.CODE Or Key.delete = Key.code Or Key.Down = Key.code Or Key.Esc = Key.code Or Key.Tab = Key.code Or Key.Insert = Key.code Or Key.left = Key.code Or Key.Right = Key.code Then 
  Else
    
    If InStr(moduloletras.posibles, Str$(Key.text)) = 0 Then 
      Stop Event
    Endif
  Endif
  
End
